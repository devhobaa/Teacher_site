{% extends "base.html" %}
{% block content %}
<!-- Hero Section -->
<section class="bg-gradient-to-br from-primary-600 to-primary-800 text-white py-12">
  <div class="container mx-auto px-6">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold mb-2">{{ exam.title }}</h1>
        <p class="text-primary-100">دورة: {{ course.title }}</p>
      </div>
      <div class="text-right">
        <div class="text-lg font-semibold">السؤال <span id="current-question">1</span> من {{ questions|length }}</div>
        <div class="text-sm text-primary-200">الوقت المتبقي: <span id="timer">15:00</span></div>
      </div>
    </div>
  </div>
</section>

<!-- Exam Section -->
<section class="py-16 bg-gray-50">
  <div class="container mx-auto px-6">
    <div class="max-w-4xl mx-auto">
      <!-- Progress Bar -->
      <div class="bg-gray-200 rounded-full h-2.5 mb-8">
        <div id="progress-bar" class="bg-primary-600 h-2.5 rounded-full" style="width: 0%"></div>
      </div>

      <form method="POST" id="exam-form">
        <div class="bg-white rounded-2xl shadow-lg p-8">
          {% if exam.description %}
          <p class="text-gray-600 mb-8 pb-8 border-b border-gray-200">{{ exam.description }}</p>
          {% endif %}
          
          {% for question in questions %}
          <div class="question-slide {% if not loop.first %}hidden{% endif %}" data-question-id="{{ loop.index }}">
            <h3 class="font-bold text-xl text-gray-800 mb-6">السؤال {{ loop.index }}: {{ question.question }}</h3>
            
            {% if question.options %}
            <div class="space-y-4">
              {% for option in question.options %}
              <label class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-primary-50 hover:border-primary-500 cursor-pointer transition-colors">
                <input type="radio" name="question_{{ loop.parent.loop.index0 }}" value="{{ loop.index0 }}" class="ml-4 text-primary-600 focus:ring-primary-500" required>
                <span class="text-gray-700">{{ option }}</span>
              </label>
              {% endfor %}
            </div>
            {% else %}
            <textarea name="question_{{ loop.parent.loop.index0 }}" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors" rows="5" placeholder="اكتب إجابتك هنا..." required></textarea>
            {% endif %}
          </div>
          {% endfor %}
          
          <div class="flex items-center justify-between mt-8 pt-8 border-t border-gray-200">
            <button type="button" id="prev-btn" class="bg-gray-200 text-gray-700 py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              السابق
            </button>
            <button type="button" id="next-btn" class="bg-primary-600 text-white py-2 px-6 rounded-lg hover:bg-primary-700 transition-colors font-semibold">
              التالي
            </button>
            <button type="submit" id="submit-btn" class="bg-green-600 text-white py-2 px-6 rounded-lg hover:bg-green-700 transition-colors font-semibold hidden" onclick="return confirm('هل أنت متأكد من تقديم الامتحان؟')">
              تقديم الامتحان
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>

<script>
  const questions = document.querySelectorAll('.question-slide');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const submitBtn = document.getElementById('submit-btn');
  const currentQuestionSpan = document.getElementById('current-question');
  const progressBar = document.getElementById('progress-bar');
  let currentQuestionIndex = 0;

  function showQuestion(index) {
    questions.forEach((q, i) => {
      q.classList.toggle('hidden', i !== index);
    });
    currentQuestionSpan.textContent = index + 1;
    progressBar.style.width = `${((index + 1) / questions.length) * 100}%`;

    prevBtn.disabled = index === 0;
    nextBtn.classList.toggle('hidden', index === questions.length - 1);
    submitBtn.classList.toggle('hidden', index !== questions.length - 1);
  }

  nextBtn.addEventListener('click', () => {
    if (currentQuestionIndex < questions.length - 1) {
      currentQuestionIndex++;
      showQuestion(currentQuestionIndex);
    }
  });

  prevBtn.addEventListener('click', () => {
    if (currentQuestionIndex > 0) {
      currentQuestionIndex--;
      showQuestion(currentQuestionIndex);
    }
  });

  // Timer
  const timerSpan = document.getElementById('timer');
  let timeLeft = 15 * 60;
  const timerInterval = setInterval(() => {
    const minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;
    seconds = seconds < 10 ? '0' + seconds : seconds;
    timerSpan.textContent = `${minutes}:${seconds}`;
    if (timeLeft === 0) {
      clearInterval(timerInterval);
      document.getElementById('exam-form').submit();
    } else {
      timeLeft--;
    }
  }, 1000);

  showQuestion(0);
</script>
{% endblock %}