{% extends "base.html" %}
{% block content %}
<!-- Course Header -->
<section class="bg-gradient-to-br from-primary-600 to-primary-800 text-white py-16">
  <div class="container mx-auto px-6">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
      <div>
        <h1 class="text-4xl md:text-5xl font-bold mb-4">{{ course.title }}</h1>
        <p class="text-xl text-primary-100 mb-6">{{ course.short_desc }}</p>
        
        <div class="flex items-center space-x-6 space-x-reverse mb-6">
          <div class="flex items-center">
            <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
            <span class="text-lg">5.0 (50 تقييم)</span>
          </div>
          <div class="flex items-center">
            <i data-lucide="users" class="w-5 h-5 ml-1"></i>
            <span class="text-lg">{{ course.students|length }} طالب</span>
          </div>
          <div class="flex items-center">
            <i data-lucide="clock" class="w-5 h-5 ml-1"></i>
            <span class="text-lg">20 ساعة</span>
          </div>
        </div>
        
        <div class="flex items-center space-x-4 space-x-reverse">
          <span class="text-3xl font-bold">{{ course.price }} جنيه</span>
          <span class="text-lg text-primary-200 line-through">{{ (course.price * 1.5)|int }} جنيه</span>
          <span class="bg-red-500 text-white px-3 py-1 rounded-full text-sm">خصم 33%</span>
        </div>
      </div>
      
      <div class="text-center">
        <div class="bg-white rounded-2xl p-2 shadow-2xl">
          {% if course.image %}
            <img src="{{ url_for('uploads', filename=course.image) }}" alt="{{ course.title }}" class="w-full h-64 object-cover rounded-xl">
          {% else %}
            <div class="w-full h-64 bg-gradient-to-br from-primary-500 to-primary-700 rounded-xl flex items-center justify-center">
              <i data-lucide="calculator" class="w-24 h-24 text-white"></i>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Course Content -->
<section class="py-16 bg-white">
  <div class="container mx-auto px-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      <!-- Main Content -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
          <h2 class="text-2xl font-bold text-primary-800 mb-6">وصف الدورة</h2>
          <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed">
            {{ course.content|safe if course.content else 'وصف تفصيلي للدورة سيتم إضافته قريباً.' }}
          </div>
        </div>

        <!-- Videos Section -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
          <h2 class="text-2xl font-bold text-primary-800 mb-6">فيديوهات الدورة</h2>
          <div class="space-y-4">
            {% for video in course.videos %}
            <div class="border border-gray-200 rounded-lg p-4">
              <h3 class="font-semibold text-lg mb-2">{{ video.title }}</h3>
              <video controls class="w-full rounded">
                <source src="{{ url_for('uploads', filename=video.file_path) }}" type="video/mp4">
                متصفحك لا يدعم عرض الفيديو.
              </video>
            </div>
            {% else %}
            <p class="text-gray-600">لا توجد فيديوهات متاحة لهذه الدورة.</p>
            {% endfor %}
          </div>
        </div>
      </div>
      
      <!-- Sidebar -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
          <div class="text-center mb-6">
            <div class="text-3xl font-bold text-primary-600 mb-2">{{ course.price }} جنيه</div>
            <div class="text-gray-500 line-through">{{ (course.price * 1.5)|int }} جنيه</div>
          </div>
          
          {% if current_user.is_authenticated %}
          {% if course not in current_user.courses %}
          <form method="POST" action="{{ url_for('subscribe_course', slug=course.slug) }}">
            <button type="submit" 
                    class="w-full bg-primary-600 text-white py-3 px-4 rounded-lg hover:bg-primary-700 transition-colors font-semibold text-center block mb-4">
              سجل في الدورة الآن
            </button>
          </form>
          {% else %}
          <div class="w-full flex items-center justify-center space-x-3 space-x-reverse bg-gray-100 py-3 px-4 rounded-lg text-center font-semibold mb-4">
            <img src="{{ url_for('uploads', filename=current_user.profile_picture) }}" alt="Profile Picture" class="w-8 h-8 rounded-full object-cover border border-gray-300">
            <span>أنت مسجل في هذه الدورة</span>
          </div>
          {% endif %}
          {% else %}
           <a href="{{ url_for('student_login') }}" 
              class="w-full bg-primary-600 text-white py-3 px-4 rounded-lg hover:bg-primary-700 transition-colors font-semibold text-center block mb-4">
             سجل في الدورة الآن
           </a>
          {% endif %}
          
          <div class="text-center text-sm text-gray-600 mb-6">
            ضمان استرداد المال خلال 30 يوم
          </div>
          
          <div class="space-y-4 border-t border-gray-200 pt-6">
            <h3 class="font-semibold text-lg">ما ستحصل عليه:</h3>
            <ul class="space-y-3">
              <li class="flex items-center">
                <i data-lucide="check" class="w-5 h-5 text-green-500 ml-2"></i>
                <span class="text-sm">20 ساعة من المحتوى التعليمي</span>
              </li>
              <li class="flex items-center">
                <i data-lucide="check" class="w-5 h-5 text-green-500 ml-2"></i>
                <span class="text-sm">وصول مدى الحياة للمحتوى</span>
              </li>
              <li class="flex items-center">
                <i data-lucide="check" class="w-5 h-5 text-green-500 ml-2"></i>
                <span class="text-sm">شهادة إتمام الدورة</span>
              </li>
              <li class="flex items-center">
                <i data-lucide="check" class="w-5 h-5 text-green-500 ml-2"></i>
                <span class="text-sm">دعم فني مستمر</span>
              </li>
              <li class="flex items-center">
                <i data-lucide="check" class="w-5 h-5 text-green-500 ml-2"></i>
                <span class="text-sm">مجموعة واتساب للطلاب</span>
              </li>
            </ul>
          </div>
          
          <div class="border-t border-gray-200 pt-6 mt-6">
            <div class="flex items-center justify-center space-x-4 space-x-reverse text-sm text-gray-600">
              <span>شارك الدورة:</span>
              <a href="#" class="text-primary-600 hover:text-primary-700">
                <i data-lucide="facebook" class="w-4 h-4"></i>
              </a>
              <a href="#" class="text-primary-600 hover:text-primary-700">
                <i data-lucide="twitter" class="w-4 h-4"></i>
              </a>
              <a href="#" class="text-primary-600 hover:text-primary-700">
                <i data-lucide="share-2" class="w-4 h-4"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}